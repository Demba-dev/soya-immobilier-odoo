<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- === GROUPES PERSONNALISÉS POUR SOYA IMMOBILIER MALI === -->
        <record id="group_soya_estate_user" model="res.groups">
            <field name="name">Utilisateur Immobilier</field>
            <field name="category_id" ref="base.module_category_services"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="group_soya_estate_agent" model="res.groups">
            <field name="name">Agent Immobilier</field>
            <field name="category_id" ref="base.module_category_services"/>
            <field name="implied_ids" eval="[(4, ref('group_soya_estate_user'))]"/>
            <field name="users" eval="[(4, ref('base.user_admin'))]"/>
        </record>

        <record id="group_soya_estate_manager" model="res.groups">
            <field name="name">Manager Immobilier</field>
            <field name="category_id" ref="base.module_category_services"/>
            <field name="implied_ids" eval="[(4, ref('group_soya_estate_agent'))]"/>
            <field name="users" eval="[(4, ref('base.user_admin'))]"/>
        </record>

        <!-- === RÈGLES MINIMALES === -->
        
        <!-- Manager: Accès complet à tous les biens -->
        <record id="soya_property_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Accès complet tous les biens</field>
            <field name="model_id" ref="model_soya_property"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- Manager: Voir toutes les offres -->
        <record id="soya_property_offer_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Toutes les offres</field>
            <field name="model_id" ref="model_soya_property_offer"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- === RÈGLES POUR LES AGENTS === -->
        
        <!-- Agent: Ne voit que ses propres biens -->
        <record id="soya_property_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Ses propres biens</field>
            <field name="model_id" ref="model_soya_property"/>
            <field name="domain_force">[('salesperson_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

        <!-- Agent: Ne voit que les offres sur ses biens -->
        <record id="soya_property_offer_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Offres sur ses biens</field>
            <field name="model_id" ref="model_soya_property_offer"/>
            <field name="domain_force">[('property_id.salesperson_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

        <!-- === RÈGLES POUR LE PORTAIL === -->

        <!-- Portail: Ne voit que ses propres offres -->
        <record id="soya_property_offer_portal_rule" model="ir.rule">
            <field name="name">SOYA Portail: Ses propres offres</field>
            <field name="model_id" ref="model_soya_property_offer"/>
            <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        </record>

        <!-- === RÈGLES POUR LES FACTURES FINANCIÈRES === -->
        
        <!-- Manager: Accès complet à toutes les factures -->
        <record id="soya_financial_invoice_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Toutes les factures</field>
            <field name="model_id" ref="model_soya_financial_invoice"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- Agent: Ne voit que les factures de ses contrats -->
        <record id="soya_financial_invoice_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Factures de ses contrats</field>
            <field name="model_id" ref="model_soya_financial_invoice"/>
            <field name="domain_force">[('contract_id.property_id.salesperson_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

        <!-- === RÈGLES POUR LES PROSPECTS === -->
        
        <!-- Manager: Accès complet à tous les prospects -->
        <record id="soya_prospect_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Tous les prospects</field>
            <field name="model_id" ref="model_soya_prospect"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- Agent: Ne voit que ses propres prospects -->
        <record id="soya_prospect_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Ses propres prospects</field>
            <field name="model_id" ref="model_soya_prospect"/>
            <field name="domain_force">[('salesperson_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

        <!-- === RÈGLES POUR LES VISITES === -->
        
        <!-- Manager: Accès complet à toutes les visites -->
        <record id="soya_visit_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Toutes les visites</field>
            <field name="model_id" ref="model_soya_visit"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- Agent: Ne voit que ses propres visites -->
        <record id="soya_visit_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Ses propres visites</field>
            <field name="model_id" ref="model_soya_visit"/>
            <field name="domain_force">[('salesperson_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

        <!-- === RÈGLES POUR LES ACTIVITÉS COMMERCIALES === -->
        
        <!-- Manager: Accès complet à toutes les activités -->
        <record id="soya_sales_activity_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Toutes les activités</field>
            <field name="model_id" ref="model_soya_sales_activity"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- Agent: Ne voit que ses propres activités -->
        <record id="soya_sales_activity_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Ses propres activités</field>
            <field name="model_id" ref="model_soya_sales_activity"/>
            <field name="domain_force">[('salesperson_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

        <!-- === RÈGLES POUR LES STATISTIQUES === -->
        
        <!-- Manager: Accès complet à toutes les statistiques de visite -->
        <record id="soya_visit_statistics_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Toutes les statistiques</field>
            <field name="model_id" ref="model_soya_visit_statistics"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- Agent: Ne voit que ses statistiques -->
        <record id="soya_visit_statistics_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Ses statistiques</field>
            <field name="model_id" ref="model_soya_visit_statistics"/>
            <field name="domain_force">[('agent_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

        <!-- Manager: Accès complet à toutes les statistiques de conversion -->
        <record id="soya_conversion_statistics_manager_rule" model="ir.rule">
            <field name="name">SOYA Manager: Toutes les stats de conversion</field>
            <field name="model_id" ref="model_soya_conversion_statistics"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_manager'))]"/>
        </record>

        <!-- Agent: Ne voit que ses stats de conversion -->
        <record id="soya_conversion_statistics_agent_rule" model="ir.rule">
            <field name="name">SOYA Agent: Ses stats de conversion</field>
            <field name="model_id" ref="model_soya_conversion_statistics"/>
            <field name="domain_force">[('agent_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_soya_estate_agent'))]"/>
        </record>

    </data>
</odoo>
